---
title: 'in situ vignette: data checking and calibration'
author: "Christina Bonsell"
date: "April 9, 2020"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{in situ vignette: data checking and calibration}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Some intro text

First let's load in some handy packages
```{r}
library(insitu)
library(RCurl) #For loading in data directly from online repositories
library(tidyverse) #we're going to work in the tidyverse for data manipulation and plotting
```

#Calculate salinity

```{r}

```



#easily read in files from different instrument types `r ?import_data()


#Look at the data

First, read in some data (this is Beaufort Lagoon Ecosystem LTER data from 2018-2019)

```{r}
urlCSV <- getURL("https://portal-s.edirepository.org/nis/dataviewer?packageid=knb-lter-ble.3.7&entityid=534373640a661d8ed0bfedc52479a133", timeout = 200)
txtCSV <- textConnection(urlCSV)
tempsal_data <- read.csv(txtCSV, stringsAsFactors = F) %>% 
  filter(station=="KALD1") %>% 
  mutate(date_time=as.POSIXct(date_time, format="%m/%d/%Y %H:%M"))
close(txtCSV)

head(tempsal_data)
str(tempsal_data)
```


Simple timeseries plots
```{r}
ggplot(tempsal_data, aes(date_time, temperature))+
  geom_line()

ggplot(tempsal_data, aes(date_time, conductivity))+
  geom_line()
```

Some of this conductivity data is clearly bad (look at that June-July weirdness)! We need to calibrate the data and remove "bad" points.


#Calibrate the data based on readings from a more recently-calibrated sensor
```{r}

```



#Identify "bad" data based on the freezing line from temperature/salinity plots
In cold regions, temperature/salinity plots can easily tell you when something is amiss in your data. This often occurs because the conductivity reading if off due to obstruction by sediments or fouling (for instruments with a conductivity cup), or by nearby ice or other conductive materials (for RBR "donuts"). 


#You can also manually identify "bad" data that doesn't get picked up from the freezing line algorithm
